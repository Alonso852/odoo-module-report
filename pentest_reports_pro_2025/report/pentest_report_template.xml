<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_pentest_qweb_preview">
        <t t-call="web.external_layout">
            <div class="page">
                <t t-foreach="docs" t-as="doc">
                    <t t-set="sections" t-value="doc.section_ids.filtered(lambda s: not s.parent_id)"/>
                    <!-- Table des matières -->
                    <h2>Table des matières</h2>
                    <ul>
                        <t t-foreach="doc.section_ids" t-as="sec">
                            <li><t t-esc="sec.number"/> <t t-esc="sec.name"/></li>
                        </t>
                    </ul>
                    <hr/>

                    <!-- Contenu -->
                    <t t-foreach="sections" t-as="sec">
                        <div class="section">
                            <h2><t t-esc="sec.number"/> <t t-esc="sec.name"/></h2>
                            <t t-if="sec.description" t-raw="sec.description"/>
                            <t t-if="sec.image_id">
                                <img t-att-src="image_data_uri(sec.image_id.datas)" style="max-width:100%;"/>
                            </t>
                            <t t-foreach="sec.child_ids" t-as="sub">
                                <h3><t t-esc="sub.number"/> <t t-esc="sub.name"/></h3>
                                <t t-if="sub.description" t-raw="sub.description"/>
                                <t t-if="sub.image_id">
                                    <img t-att-src="image_data_uri(sub.image_id.datas)" style="max-width:100%;"/>
                                </t>
                            </t>
                        </div>
                    </t>
                </t>
            </div>
        </t>
    </template>

    <template id="report_pentest_qweb">
        <t t-call="web.external_layout">
            <t t-set="confidentiality" t-value="doc.confidentiality.upper()"/>
            <div class="page">
                <div style="position:absolute; top:40%; left:30%; opacity:0.1; font-size:100px; transform:rotate(-45deg); color:red;">
                    <t t-esc="confidentiality"/>
                </div>
                <t t-call="pentest_reports.report_pentest_qweb_preview"/>
            </div>
        </t>
    </template>
</odoo>
