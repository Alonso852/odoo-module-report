<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_pentest_document">
        <t t-set="layout" t-value="doc._get_layout_config()"/>
        <t t-set="root_sections" t-value="doc.section_ids.filtered(lambda s: not s.parent_id)"/>
        <t t-set="status_label" t-value="dict(doc._fields['status'].selection).get(doc.status)"/>
        <t t-set="confidentiality_label" t-value="dict(doc._fields['confidentiality'].selection).get(doc.confidentiality)"/>
        <div class="o_pentest_report">
            <style type="text/css">
                .o_pentest_report {
                    font-size: <t t-esc="layout['body_font_size']"/>px;
                    line-height: 1.5;
                    color: #1f1f1f;
                }
                .o_pentest_cover {
                    border: 1px solid #e3e3e3;
                    padding: 32px;
                    border-radius: 6px;
                    margin-bottom: 32px;
                    background: #f8fbff;
                }
                .o_pentest_cover h1 {
                    font-size: <t t-esc="layout['title_font_size']"/>px;
                    color: <t t-esc="layout['accent_color']"/>;
                    margin-bottom: 8px;
                }
                .o_pentest_meta {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 16px;
                    margin-top: 16px;
                    font-size: <t t-esc="layout['subtitle_font_size']"/>px;
                }
                .o_pentest_meta span {
                    background: rgba(0, 0, 0, 0.03);
                    padding: 6px 12px;
                    border-radius: 4px;
                }
                .o_pentest_report_toc {
                    margin-bottom: 24px;
                }
                .o_pentest_report_toc h2 {
                    font-size: <t t-esc="layout['section_font_size']"/>px;
                    color: <t t-esc="layout['accent_color']"/>;
                    border-bottom: 2px solid <t t-esc="layout['accent_color']"/>;
                    padding-bottom: 8px;
                }
                .o_pentest_report_toc ul {
                    list-style: none;
                    padding-left: 0;
                }
                .o_pentest_report_toc li {
                    margin: 6px 0;
                }
                .o_pentest_section {
                    margin-bottom: 32px;
                    page-break-inside: avoid;
                }
                .o_pentest_section h2,
                .o_pentest_section h3,
                .o_pentest_section h4 {
                    color: <t t-esc="layout['accent_color']"/>;
                }
                .o_pentest_section h2 {
                    font-size: <t t-esc="layout['section_font_size']"/>px;
                    border-bottom: 1px solid #dce0e6;
                    padding-bottom: 4px;
                    margin-bottom: 8px;
                }
                .o_pentest_section h3 {
                    font-size: <t t-esc="layout['subtitle_font_size']"/>px;
                    margin-bottom: 6px;
                }
                .o_pentest_section .subtitle {
                    font-style: italic;
                    color: #5f6368;
                    margin-bottom: 8px;
                }
                .o_pentest_media img {
                    max-width: 100%;
                    margin: 12px 0;
                    border-radius: 4px;
                    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
                }
                .o_pentest_watermark {
                    position: absolute;
                    top: 35%;
                    left: 20%;
                    opacity: 0.08;
                    font-size: 120px;
                    transform: rotate(-35deg);
                    color: #8d99ae;
                }
            </style>
            <div class="o_pentest_cover">
                <h1>
                    <t t-esc="doc.name"/>
                </h1>
                <div class="subtitle">
                    <strong>Client:</strong>
                    <t t-esc="doc.client"/>
                </div>
                <div class="o_pentest_meta">
                    <span>
                        <strong>Reference:</strong>
                        <t t-esc="doc.reference"/>
                    </span>
                    <span>
                        <strong>Status:</strong>
                        <t t-esc="status_label or doc.status"/>
                    </span>
                    <span>
                        <strong>Confidentiality:</strong>
                        <t t-esc="confidentiality_label or doc.confidentiality"/>
                    </span>
                    <span>
                        <strong>Version:</strong>
                        <t t-esc="doc.version"/>
                    </span>
                </div>
            </div>
            <div class="o_pentest_report_toc">
                <h2>Table of contents</h2>
                <ul>
                    <t t-call="pentest_reports_pro_2025.report_pentest_toc">
                        <t t-set="sections" t-value="root_sections"/>
                    </t>
                </ul>
            </div>
            <div class="o_pentest_body">
                <t t-call="pentest_reports_pro_2025.report_pentest_sections">
                    <t t-set="sections" t-value="root_sections"/>
                    <t t-set="layout" t-value="layout"/>
                </t>
            </div>
        </div>
    </template>

    <template id="report_pentest_toc">
        <t t-foreach="sections" t-as="section">
            <li>
                <strong><t t-esc="section.number"/></strong>
                <span>
                    <t t-esc="section.name"/>
                    <t t-if="section.subtitle"> â€” <t t-esc="section.subtitle"/></t>
                </span>
                <t t-if="section.child_ids">
                    <ul>
                        <t t-call="pentest_reports_pro_2025.report_pentest_toc">
                            <t t-set="sections" t-value="section.child_ids"/>
                        </t>
                    </ul>
                </t>
            </li>
        </t>
    </template>

    <template id="report_pentest_sections">
        <t t-foreach="sections" t-as="section">
            <div class="o_pentest_section">
                <h2>
                    <span><t t-esc="section.number"/> <t t-esc="section.name"/></span>
                </h2>
                <t t-if="section.subtitle">
                    <div class="subtitle">
                        <t t-esc="section.subtitle"/>
                    </div>
                </t>
                <div class="o_pentest_description">
                    <t t-if="section.description" t-raw="section.description"/>
                </div>
                <t t-if="section.image_1920">
                    <div class="o_pentest_media">
                        <img t-att-src="image_data_uri(section.image_1920)" alt="section image"/>
                    </div>
                </t>
                <t t-if="section.child_ids">
                    <t t-call="pentest_reports_pro_2025.report_pentest_sections">
                        <t t-set="sections" t-value="section.child_ids"/>
                        <t t-set="layout" t-value="layout"/>
                    </t>
                </t>
            </div>
        </t>
    </template>

    <template id="report_pentest_qweb_preview">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="page">
                    <t t-call="pentest_reports_pro_2025.report_pentest_document"/>
                </div>
            </t>
        </t>
    </template>

    <template id="report_pentest_qweb">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="page">
                    <div class="o_pentest_watermark">
                        <t t-esc="doc.confidentiality and doc.confidentiality.upper()"/>
                    </div>
                    <t t-call="pentest_reports_pro_2025.report_pentest_document"/>
                </div>
            </t>
        </t>
    </template>
</odoo>
