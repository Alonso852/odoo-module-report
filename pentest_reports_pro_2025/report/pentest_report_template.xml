<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_pentest_document">
        <div class="o_pentest_report">
            <style type="text/css">
                .o_pentest_watermark {
                    position: absolute;
                    top: 35%;
                    left: 20%;
                    opacity: 0.08;
                    font-size: 120px;
                    transform: rotate(-35deg);
                    color: #8d99ae;
                }
                .o_pentest_section h2 {
                    margin-top: 32px;
                    border-bottom: 1px solid #ddd;
                    padding-bottom: 8px;
                }
            </style>
            <t t-set="sections" t-value="doc.section_ids.filtered(lambda s: not s.parent_id)"/>
            <div class="o_pentest_report_header">
                <h1>
                    <t t-esc="doc.name"/>
                </h1>
                <p>
                    <strong>Client:</strong>
                    <t t-esc="doc.client"/>
                </p>
                <p>
                    <strong>Reference:</strong>
                    <t t-esc="doc.reference"/>
                </p>
            </div>
            <div class="o_pentest_report_toc">
                <h2>Table of contents</h2>
                <ul>
                    <t t-foreach="doc.section_ids" t-as="sec">
                        <li>
                            <t t-esc="sec.number"/>
                            <t t-esc="sec.name"/>
                        </li>
                    </t>
                </ul>
            </div>
            <t t-foreach="sections" t-as="sec">
                <div class="o_pentest_section">
                    <h2>
                        <t t-esc="sec.number"/>
                        <t t-esc="sec.name"/>
                    </h2>
                    <t t-if="sec.description" t-raw="sec.description"/>
                    <t t-if="sec.image_id">
                        <img t-att-src="image_data_uri(sec.image_id.datas)" style="max-width: 100%; margin: 16px 0;"/>
                    </t>
                    <t t-foreach="sec.child_ids" t-as="child">
                        <h3>
                            <t t-esc="child.number"/>
                            <t t-esc="child.name"/>
                        </h3>
                        <t t-if="child.description" t-raw="child.description"/>
                        <t t-if="child.image_id">
                            <img t-att-src="image_data_uri(child.image_id.datas)" style="max-width: 100%; margin: 8px 0;"/>
                        </t>
                    </t>
                </div>
            </t>
        </div>
    </template>

    <template id="report_pentest_qweb_preview">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="page">
                    <t t-call="pentest_reports_pro_2025.report_pentest_document"/>
                </div>
            </t>
        </t>
    </template>

    <template id="report_pentest_qweb">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="page">
                    <div class="o_pentest_watermark">
                        <t t-esc="doc.confidentiality and doc.confidentiality.upper()"/>
                    </div>
                    <t t-call="pentest_reports_pro_2025.report_pentest_document"/>
                </div>
            </t>
        </t>
    </template>
</odoo>
